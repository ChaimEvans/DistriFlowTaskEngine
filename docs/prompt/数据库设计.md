### 处理程序
```sql
CREATE TABLE Program (
    id INT PRIMARY KEY NOT NULL AUTO_INCREMENT,
    name VARCHAR(128) NOT NULL UNIQUE,
    title VARCHAR(128),
    description TEXT,
    file VARCHAR(512) NOT NULL,
	cmd VARCHAR(512) NOT NULL,
	lock BOOLEAN NOT NULL DEFAULT FALSE,
	updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```
- **id** —— ID
- **name** —— 标识名称
- **title** —— 显示名称
- **description** —— 描述
- **file** —— 上传到服务器中的文件路径
- **cmd** —— 启动命令
- **lock** —— 运行时上锁，上锁不可修改

### 工作流
```sql
CREATE TABLE Workflow (
    id INT PRIMARY KEY NOT NULL AUTO_INCREMENT,
    name VARCHAR(128) NOT NULL,
    description TEXT,
    data JSON,
    lock BOOLEAN NOT NULL DEFAULT False,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```
- **id** —— ID
- **name** —— 工作流名称
- **description** —— 描述
- **data** —— 工作流数据
- **lock** —— 运行时上锁，上锁不可修改

### 参数
```sql
CREATE TABLE Param (
	id INT PRIMARY KEY NOT NULL AUTO_INCREMENT,
    program INT,
    workflow INT,
    name VARCHAR(128) NOT NULL,
    type VARCHAR(128),
    description TEXT,
    retval BOOLEAN NOT NULL DEFAULT False,
    require BOOLEAN NOT NULL DEFAULT True,
    FOREIGN KEY (program) REFERENCES Programs(id) ON DELETE CASCADE,
    FOREIGN KEY (workflow) REFERENCES Workflow(id) ON DELETE CASCADE,
    CONSTRAINT CHK_Param_SingleParent CHECK (
	    (program IS NOT NULL AND workflow IS NULL) OR
	    (program IS NULL AND workflow IS NOT NULL)
	),
	CONSTRAINT UQ_Program_Param UNIQUE (program, name),
	CONSTRAINT UQ_Workflow_Param UNIQUE (workflow, name)
);
```
- **id** —— ID
- **program** —— 隶属的处理程序（外键，会被级联删除）
- **workflow** —— 隶属的工作流（外键，会被级联删除）
- **name** —— 参数名称
- **description** —— 参数描述
- **retval** —— 是否是返回值
- **require** —— 是否为必须参数

### 项目
```sql
CREATE TABLE Project (
    id INT PRIMARY KEY NOT NULL AUTO_INCREMENT,
    name VARCHAR(128) NOT NULL,
    workflow INT,
    workflow_input JSON NOT NULL,
    FOREIGN KEY (workflow) REFERENCES Workflow(id) ON DELETE SET NULL,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP
);
```
- **id** —— ID
- **name** —— 项目名称
- **workflow** —— 所使用的工作流
- **workflow_input** —— 工作流输入数据（默认{}）

### 任务
```sql
CREATE TABLE Task (
	uuid BINARY(16) PRIMARY KEY NOT NULL,
	parent BINARY(16),
	name VARCHAR(128),
	running_record INT NOT NULL,
	project INT,
	workflow INT,
	node_id INT,
	program INT,
	method INT,
	params JSON,
	status INT NOT NULL DEFAULT 0,
	retmsg TEXT,
	retdata JSON NOT NULL,
	FOREIGN KEY (parent) REFERENCES Task(uuid) ON DELETE SET NULL,
	FOREIGN KEY (running_record) REFERENCES RunningRecord(id) ON DELETE CASCADE,
	FOREIGN KEY (project) REFERENCES Project(id) ON DELETE SET NULL,
	FOREIGN KEY (workflow) REFERENCES Workflow(id) ON DELETE SET NULL,
	FOREIGN KEY (program) REFERENCES Program(id) ON DELETE SET NULL,
	created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
)
```
- **uuid** —— UUID
- **parent** —— 父级任务
- **name** —— 任务名称
- **running_record** —— 所隶属的运行记录（外键，会被级联删除）
- **project** —— 隶属的项目
- **workflow** —— 隶属的工作流
- **node_id** —— 对应工作流JSON节点的id
- **program** —— 使用的处理程序
- **method** —— 使用的内置处理方法
- **params** —— 传入的参数
- **status** —— 状态（-2：失败，-1：跳过，0：等待中，1：处理中，2：成功）
- **retmsg** —— 任务结束时返回的文本型消息（默认{}）
- **retdata** —— 任务成功后返回的JSON数据

### 运行记录
```sql
CREATE TABLE RunningRecord (
    id INT PRIMARY KEY NOT NULL AUTO_INCREMENT,
    workflow INT,
    workflow_data JSON NOT NULL,
    workflow_input JSON NOT NULL,
    workflow_output JSON NOT NULL,
    project INT,
    finish BOOLEAN NOT NULL DEFAULT False,
    FOREIGN KEY (workflow) REFERENCES Workflow(id) ON DELETE SET NULL,
    FOREIGN KEY (project) REFERENCES Project(id) ON DELETE SET NULL,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```
- **id** —— ID
- **workflow** —— 对应的工作流
- **workflow_data** —— 对应的工作流的数据拷贝（仅事后查看用）
- **workflow_input** —— 工作流输入数据（默认{}）
- **workflow_output** —— 工作流输出数据（默认[]）
- **project** —— 隶属的项目
- **finish** —— 是否已结束